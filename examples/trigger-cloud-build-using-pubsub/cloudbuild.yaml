substitutions:
  _ENV: "dev"
  _SERVICE_NAME: "default"

steps:
  # Step 1: Validate input parameters
  - name: "gcr.io/cloud-builders/bash"
    id: "validate-inputs"
    entrypoint: "bash"
    args:
      - -c
      - |
        VALID_ENVS=("dev" "staging" "prod")
        if [[ ! " ${VALID_ENVS[@]} " =~ " ${_ENV} " ]]; then
          echo "‚ùå ERROR: Invalid _ENV value '${_ENV}'. Allowed: dev, staging, prod"
          exit 1
        fi

        if [[ -z "${_SERVICE_NAME}" ]]; then
          echo "‚ùå ERROR: _SERVICE_NAME cannot be empty"
          exit 1
        fi

        echo "‚úÖ Input validation passed"
  # Step 2: Your actual build step
  - name: "gcr.io/cloud-builders/gcloud"
    id: "run-build"
    entrypoint: "bash"
    args:
      - -c
      - |
        echo "üöÄ Starting build for service: ${_SERVICE_NAME} in environment: ${_ENV}"
        # Simulate build process
        sleep 5
        echo "‚úÖ Build completed successfully"
